direction: down

style: {
  font-color: "#000000"
}

title: {
  label: System Architecture
  near: top-center
  shape: text
  style: {
    font-size: 24
    bold: true
  }
}

# ============================================================================
# USER
# ============================================================================
user: User {
  shape: person
  style.fill: "#e3f2fd"
}

# ============================================================================
# TWO DEPLOYMENT MODES
# ============================================================================
hidamari_mode: Hidamari Mode {
  shape: rectangle
  style.fill: "#e1f5fe"
  style.stroke: "#0277bd"
  style.stroke-width: 3

  single_file: wallpaper-*.html {
    shape: page
    style.fill: "#ffffff"
    label: |md
      **Single HTML File**
      • All CSS embedded
      • All JS embedded
      • Theme data embedded
      • Canvas 2D animation
      • No external files
      • No API access
    |
  }
}

browser_mode: Browser Mode {
  shape: rectangle
  style.fill: "#fff3e0"
  style.stroke: "#e65100"
  style.stroke-width: 3

  multi_file: background.html {
    shape: page
    style.fill: "#ffffff"
    label: |md
      **Multi-File Setup**
      • Loads external CSS/JS
      • Fetches config.json
      • Dynamic theme loading
      • Canvas 2D animation
      • API polling (5s)
      • Live system metrics
    |
  }
}

# ============================================================================
# BACKEND API (Browser Mode Only)
# ============================================================================
api: Flask REST API {
  shape: rectangle
  style.fill: "#e8f5e9"
  style.stroke: "#2e7d32"
  style.stroke-width: 2

  endpoints: |md
    **Endpoints:**
    GET /api/stats
    GET /api/cpu
    GET /api/ram
    GET /api/disk
    GET /api/network
  |

  systemd: systemd service {
    shape: hexagon
    style.fill: "#c8e6c9"
  }
}

# ============================================================================
# SYSTEM RESOURCES
# ============================================================================
system: System Resources {
  shape: rectangle
  style.fill: "#ffecb3"
  style.stroke: "#f57f17"

  psutil: psutil → /proc, /sys {
    shape: package
    style.fill: "#fff9c4"
  }
}

# ============================================================================
# SOURCE FILES
# ============================================================================
source: Source Files {
  shape: rectangle
  style.fill: "#f3e5f5"
  style.stroke: "#6a1b9a"

  base: theme/base/ {
    label: |md
      background.html
      template.css
      template.js
      background-manager.js
    |
  }

  themes: theme/themes/ {
    label: |md
      12 themes:
      • theme.json
      • background.js
      • openbar-theme-config
    |
  }

  config: theme/config/ {
    label: "config.json"
  }
}

# ============================================================================
# BUILD SYSTEM
# ============================================================================
build: Build Process {
  shape: rectangle
  style.fill: "#fce4ec"
  style.stroke: "#c2185b"

  script: build.sh {
    shape: stored_data
    style.fill: "#f8bbd0"
    label: |md
      Compiles:
      base + themes
      → single HTML files
    |
  }
}

# ============================================================================
# INSTALLED FILES
# ============================================================================
installed: ~/WallpagesThemes/ {
  shape: rectangle
  style.fill: "#e0f2f1"
  style.stroke: "#00897b"

  dirs: |md
    base/
    config/
    themes/
    compiled/
  |
}

# ============================================================================
# CONNECTIONS
# ============================================================================
user -> hidamari_mode: Uses Hidamari {
  style.stroke: "#0277bd"
  style.stroke-width: 2
}

user -> browser_mode: Opens in browser {
  style.stroke: "#e65100"
  style.stroke-width: 2
}

browser_mode -> api: Polls every 5s {
  style.stroke: "#2e7d32"
  style.stroke-width: 3
  style.animated: true
}

hidamari_mode -> api: Polls every 5s {
  style.stroke: "#2e7d32"
  style.stroke-width: 3
  style.animated: true
}

api -> system: Queries metrics {
  style.stroke: "#f57f17"
  style.stroke-width: 2
}

system -> api: Returns data {
  style.stroke: "#f57f17"
  style.stroke-width: 2
}

source.base -> build.script: Read templates {
  style.stroke: "#c2185b"
  style.stroke-dash: 3
}

source.themes -> build.script: Read themes {
  style.stroke: "#c2185b"
  style.stroke-dash: 3
}

source.config -> build.script: Embed config {
  style.stroke: "#c2185b"
  style.stroke-dash: 3
}

build.script -> installed: Generates files {
  style.stroke: "#00897b"
  style.stroke-width: 2
}

installed -> hidamari_mode: compiled/*.html {
  style.stroke: "#0277bd"
  style.stroke-dash: 3
}

installed -> browser_mode: base/background.html {
  style.stroke: "#e65100"
  style.stroke-dash: 3
}

# ============================================================================
# LEGEND
# ============================================================================
legend: {
  shape: rectangle
  near: bottom-right
  style.fill: "#fafafa"
  style.stroke: "#424242"

  label: |md
    **Key Points:**
    • Hidamari: Standalone single HTML files
    • Browser: Dynamic multi-file with API
    • API provides live system metrics
    • Build process creates both modes
    • 12 animated Canvas 2D themes
  |
}
